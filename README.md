### Project stucture

A standard project build in hardhat is as follow:

```sh
contracts/
scripts/
test/
hardhat.config.js
```

- palce fileds write in solidity in contracts
- palce scripts files such as deploying contracts in scripts
- palce testing scripts named with `contractName.test.js` in test
- `hardhat.config.js` is config file of hardhat

### Configuration of hardhat

`hardhat.config.js` config file example

```js
require('@nomiclabs/hardhat-waffle');
require('dotenv').config();

module.exports = {
  networks: {
    // hardhat build-in testing network (optional)
    hardhat: {
      // a fixed gasPrice could be set, it will be useful when testing gas consumption
      gasPrice: 1000000000,
    },
    // you could config arbitrary network
    // rinkeby testing network
    rinkeby: {
      // place INFURA_ID to yours
      // url: 'https://rinkeby.infura.io/v3/{INFURA_ID}',
      url: 'https://rinkeby.infura.io/v3/' + process.env.INFURA_ID, //<---- 在.env文件中配置自己的INFURA_ID

      //  place multiple privateKeyX to yours
      accounts: [process.env.PRIVATE_KEY, ...]
    }
  },
  solidity: {
    version: "0.8.19", // version of compiling contract, required
    settings: { // setting of compile, optional
      optimizer: {  // setting of optimizing
        enabled: true,
        runs: 200
      }
    }
  },

  // config project paths, any path could be specified, The following is a common template
  // files in sources, test, scripts will be executed one by one
  paths: {
    sources: "./contracts", // directory of contracts
    tests: "./test",  // directory of test files
    cache: "./cache", // cache directory, generated by hardhat
    artifacts: "./artifacts" // directory of compiling result, generated by hardhat
  },
  // setting of testing framework
  mocha: {
    timeout: 20000  // max waiting time of running unit test
  }
}
```

### Build-in hardhat network

hardhat has a special, secure and build-in testing network, named `hardhat`, you don't need a special configuration for it. The network will follow the mechanism in real block chain network, and it will generate 10 test accounts for you (just like truffle).

### Using plugins

Plugins have many functions in Hardhat, you could choose arbitrary plugins as a developer

```js
require('@openzeppelin/hardhat-upgrades');
require("@nomiclabs/hardhat-web3");
require("@nomiclabs/hardhat-ethers");
require("@nomiclabs/hardhat-etherscan");

```

### Install dependencies

1. install nodejs (ignore)

2. install project dependencies:

   ```sh
   npm install
   ```

   or use yarn to intall (yarn installed firstly)

   ```sh
   yarn
   ```

3. config private key and network:

   create `.env` file in the directory of project, add private key and infura node to the file

   ```js
 INFURA_API_KEY="xxxxx"
#  depolyer合约拥有者
GOERLI_PRIVATE_KEY1="xxxxxxxxx"
#  operator合约操作者
GOERLI_PRIVATE_KEY2="xxxxxxxxx"
ETHERSCAN_API_KEY="xxxxx"
POLYGON_MUMBAISCAN_API_KEY="xxxxx"
BSCSCAN_API_KEY="xxxx"
GOERLI_WETH=""

## account2: ""
ETH_PK_2=""
## account3: ""
ETH_PK_3=""
## account4 
ETH_PK_4=""

## sign account (test)
SIGN_PUB=""
SIGN_PRI=""

   ```

## Usage

useage of hardhat

### Compile

Run the command, hardhat will compile all contracts file in directory of `sources`, the default path is `./contracts`

```sh
npx hardhat compile
```

### Test

Run the command, hardhat will compile all test files in directory of `tests`, the default path is `./test`

```sh
npx hardhat test
```

you could also specify some test files to run it

```sh
npx hardhat test ./test/CoreskyHub.test.js
```

### Run

Run the specified script. If you are not, it will run on hardhat's build-in network by default(Hardhat Network).

```sh
npx hardhat run ./scripts/deploy.js
```

Run the specified network, such as the contract deployed on rinkeby test network(make sure that the wallet could pay the gas)

```sh
npx hardhat run ./scripts/deploy.js --network sepolia
```

### Task

hardhat preset some task itself, such as compiling contract, running testing scripts. Those are build-in hardhat tasks.

Actually you could also customize some tasks, such as printing status of the current network's account

```js
// hardhat.config.js
...

task('accounts', 'Prints the list of accounts', async () => {
  const accounts = await ethers.getSigners();

  for (const account of accounts) {
    console.log(account.address);
  }
});

...
```

run task

```sh
npx hardhat accounts
```

terminal will print 10 addresses of testing account

```sh
0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266
...
```

### Console

The console mode of hardhat could interact with chain in real-time, where the hardhat build-in network is started by default.

```sh
npx hardhat console
```

we can directly use build-in ethers and web3 library, no need to import.

```js
// hardhat console mode:
// directly use async/await
> await ethers.provider.getBlockNumber()  // 0
```

### console.log debug

hardhat provide the `console.log()` method to print logs, debug and test when running the contract . **Only valid in hardhat build-int network**

you can use is by importing `hardhat/console.sol` in your contract

```solidity
import "hardhat/console.sol";

contract Greeter {
  ...

  function setGreeting(string memory _greeting) public {
    console.log("Changing greeting from '%s' to '%s'", greeting, _greeting);
    greeting = _greeting;
  }

}
```

When running test scripts, you can check logs:

```sh
Changing greeting from 'Hello, world!' to 'hello coresky!'
```

## Steps

### Compile and test

1. compile the contract

   ```bash
   npx hardhat compile
   ```

2. batch run test scripts

   ```bash
   npx hardhat test
   ```

3. deploy to test network

   ```bash
   npx hardhat run scripts/deploy.js --network <network-name>
   ```

3. contract verify 

   ```bash
    npx hardhat verify --network <network-name> <address> <unlock time>
   ```
   `network-name` should be replaced with your networks, `sepolia` is a choice which exists in the config file.

## Reference

- hardhat offical document: <https://hardhat.org/guides/project-setup.html>
- hardhat chinese document: <https://learnblockchain.cn/docs/hardhat/getting-started/>
- the usage of ethers.js and hardhat : <https://www.bilibili.com/video/BV1Pv411s7Nb>
- <https://rahulsethuram.medium.com/the-new-solidity-dev-stack-buidler-ethers-waffle-typescript-tutorial-f07917de48ae>
- erc20 openzepplin introduction: <https://segmentfault.com/a/1190000015400380>
